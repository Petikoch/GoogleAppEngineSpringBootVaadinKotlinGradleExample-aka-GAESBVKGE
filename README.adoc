= GAESBVKGE: The Google App Engine (Flex) Spring Boot Vaadin Kotlin Gradle (Kotlin DSL) Example
Peti Koch
:imagesdir: ./docs

Live Demo: https://gaesbvkge.appspot.com/

== Introduction

This example shows the setup of a Gradle project using these fascinating pieces of software

* Google App Engine Flex Java 8 Runtime
** https://cloud.google.com/appengine/docs/flexible/java/dev-java-only
** with the V.2 Gradle Plugin
*** https://github.com/GoogleCloudPlatform/app-gradle-plugin
* Spring Boot 2.1.x
** https://spring.io/projects/spring-boot
** https://start.spring.io/
* Vaadin 13.0.x
** https://vaadin.com/tutorials/vaadin-quick-start
* Kotlin 1.3.x running on Java 8
** https://kotlinlang.org/docs/reference/
* Gradle 5.4.x
** with the new, type-safe "Gradle Kotlin DSL" Syntax (instead the "old", dynamic Groovy syntax)
** https://gradle.org/

If you want to deploy this example yourself

. Install the tooling for "Google Cloud" according https://cloud.google.com/appengine/docs/flexible/java/quickstart
. Update to the lastest version of the `gcloud` tooling using `gcloud components update`
. Run `gradlew appengineDeploy`

== Steps to produce this example

. Create a minimal Spring Boot Vaadin Kotlin Example (approx. 5 Minutes)
.. https://start.spring.io/
.. Pick all the stuff you need/want (Gradle/Maven, Java/Kotlin/Groovy, Vaadin, Security, Reactive Web, ...) and download the result
.. Unpack it, open it in your favourite IDE (e.g. IntelliJ) and run it using `gradlew bootRun`

. Add a minimal Vaadin Page (approx. 5 Minutes)
.. I used `MainView` from https://spring.io/guides/gs/crud-with-vaadin/
.. Result: link:src/main/kotlin/ch/petikoch/examples/gaesbvkge/ui/vaadin/MainView.kt[src/main/kotlin/ch/petikoch/examples/gaesbvkge/ui/vaadin/MainView.kt]

. Adjust the Grade project with the necessary lines and files like `app.yaml` for deployments to the Google App Engine (Flex) (approx. 5 minutes if you follow my example)
.. This was the hard stuff for me... it took hours to find the right bits from the sea of outdated and sometimes incomplete information (I wasn't a GAE user before)
.. Since Vaadin is a server-side focused technology, it needs "sticky sessions", which wasn't available in Flex, up to to recent introduction of the WebSockets Beta
... https://cloud.google.com/blog/products/application-development/introducing-websockets-support-for-app-engine-flexible-environment
... https://cloud.google.com/appengine/docs/flexible/java/using-websockets-and-session-affinity (scroll down to the end)
... Add `network/session_affinity: true` to link:src/main/appengine/app.yaml[src/main/appengine/app.yaml]
.. The default `resources.memory_gb` in link:src/main/appengine/app.yaml[src/main/appengine/app.yaml] is 0.6 and was too small for this "Spring Boot Vaadin Combo". The GAE instances did not start up properly and were not considered "healthy", the deployment always failed.
... I set it to `2` gb, see link:src/main/appengine/app.yaml[src/main/appengine/app.yaml]
.. Using the "new" 2.x Version of the App Engine Gradle Plugin
... https://github.com/GoogleCloudPlatform/app-gradle-plugin
... and not the old, deprecated 1.x Version (https://github.com/GoogleCloudPlatform/gradle-appengine-plugin) which is everywhere in the official documentation (like here https://cloud.google.com/appengine/docs/flexible/java/using-gradle)
... Result: link:build.gradle.kts[build.gradle.kts]
.. Properly configure the Gradle App Engine Plugin
... There were no "Gradle Kotlin DSL" syntax examples, all the examples used the Groovy Syntax
... See/upvote https://github.com/GoogleCloudPlatform/app-gradle-plugin/issues/348
... Result: link:build.gradle.kts[build.gradle.kts]

== Final last words

I hope this example helps the reader to save some hours "to set things up".
If you have questions / remarks, please use issue tracker of this Github project.

Thanks to all the creators of the fascinating pieces of software used in the examples like

* Google App Engine
* Spring Boot
* Vaadin
* Kotlin
* Gradle

And to all the creators of the underlying technology like Java, Linux, Docker, Kubernetes, HTTP, TCP, ...

Best regards,

image::Signature.jpg[]